<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Library of Elements — Run 2026-02-12_1929</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=DM+Sans:wght@400;500;700&family=IBM+Plex+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --primary-purple: #31135D;
  --primary-purple-hover: #251047;
  --secondary-purple: rgb(109, 49, 194);
  --accent-purple: rgb(140, 104, 238);
  --text-dark: #1a1a1a;
  --text-gray: #6b7280;
  --text-light-gray: #9ca3af;
  --bg-white: #ffffff;
  --bg-light: #f9fafb;
  --bg-off-white: rgb(252, 250, 255);
  --border-color: #e5e7eb;
  --shadow-sm: 0 1px 3px rgba(0,0,0,0.05);
  --shadow-md: 0 2px 8px rgba(0,0,0,0.08);
  --shadow-lg: 0 4px 12px rgba(0,0,0,0.15);
  --shadow-xl: 0 4px 16px rgba(49,19,93,0.35);
  --rounded-lg: 8px;
  --rounded-xl: 12px;
  --rounded-pill: 20px;
  --font-inter: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  --font-dm: 'DM Sans', sans-serif;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: var(--font-inter);
  background: var(--bg-light);
  color: var(--text-dark);
  line-height: 1.5;
  -webkit-font-smoothing: antialiased;
}

/* ===== HEADER ===== */
.lib-header {
  background: linear-gradient(135deg, #31135D 0%, #5a2d8f 100%);
  padding: 48px 32px 40px;
  color: #fff;
}
.lib-header-inner {
  max-width: 1280px;
  margin: 0 auto;
}
.lib-header h1 {
  font-family: var(--font-dm);
  font-size: 32px;
  font-weight: 700;
  margin-bottom: 4px;
  letter-spacing: -0.02em;
}
.lib-header .run-meta {
  font-size: 14px;
  color: rgba(255,255,255,0.7);
  margin-bottom: 24px;
}
.lib-header .run-meta span {
  color: rgba(255,255,255,0.9);
  font-weight: 600;
}

/* ===== SEARCH ===== */
.search-bar {
  position: relative;
  max-width: 520px;
}
.search-bar input {
  width: 100%;
  padding: 12px 16px 12px 44px;
  border: 1.5px solid rgba(255,255,255,0.2);
  border-radius: var(--rounded-pill);
  background: rgba(255,255,255,0.1);
  color: #fff;
  font-size: 14px;
  font-family: var(--font-inter);
  backdrop-filter: blur(8px);
  transition: border-color 0.15s ease, background 0.15s ease;
}
.search-bar input::placeholder { color: rgba(255,255,255,0.5); }
.search-bar input:focus {
  outline: none;
  border-color: rgba(255,255,255,0.5);
  background: rgba(255,255,255,0.15);
}
.search-bar .search-icon {
  position: absolute;
  left: 16px;
  top: 50%;
  transform: translateY(-50%);
  color: rgba(255,255,255,0.5);
  font-size: 16px;
  pointer-events: none;
}

/* ===== TOOLBAR ===== */
.toolbar {
  max-width: 1280px;
  margin: 0 auto;
  padding: 20px 32px;
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 12px;
}
.filter-group {
  display: flex;
  align-items: center;
  gap: 6px;
  flex-wrap: wrap;
}
.filter-group-label {
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--text-light-gray);
  margin-right: 2px;
}
.chip {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 6px 14px;
  border: 1.5px solid var(--border-color);
  border-radius: var(--rounded-pill);
  background: var(--bg-white);
  font-size: 12px;
  font-weight: 500;
  color: var(--text-gray);
  cursor: pointer;
  transition: all 0.1s ease;
  user-select: none;
}
.chip:hover {
  border-color: var(--accent-purple);
  color: var(--secondary-purple);
  background: var(--bg-off-white);
}
.chip.active {
  border-color: var(--secondary-purple);
  background: var(--bg-off-white);
  color: var(--secondary-purple);
  font-weight: 600;
}
.chip .chip-count {
  background: var(--bg-off-white);
  color: var(--secondary-purple);
  font-size: 10px;
  font-weight: 700;
  padding: 1px 6px;
  border-radius: 10px;
}
.chip.active .chip-count {
  background: var(--secondary-purple);
  color: #fff;
}
.toolbar-spacer { flex: 1; }
.compare-toggle {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 8px 16px;
  border: 1.5px solid var(--border-color);
  border-radius: var(--rounded-pill);
  background: var(--bg-white);
  font-size: 13px;
  font-weight: 500;
  color: var(--text-gray);
  cursor: pointer;
  transition: all 0.15s ease;
}
.compare-toggle:hover {
  border-color: var(--accent-purple);
  color: var(--secondary-purple);
}
.compare-toggle.active {
  border-color: var(--secondary-purple);
  background: var(--secondary-purple);
  color: #fff;
}
.compare-toggle .toggle-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--text-light-gray);
  transition: background 0.1s ease;
}
.compare-toggle.active .toggle-dot {
  background: #fff;
}
.results-count {
  font-size: 13px;
  color: var(--text-light-gray);
  padding: 0 8px;
}

/* ===== GRID ===== */
.grid-container {
  max-width: 1280px;
  margin: 0 auto;
  padding: 0 32px 64px;
}
.card-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
  gap: 20px;
}

/* ===== CARD ===== */
.element-card {
  background: var(--bg-white);
  border: 1.5px solid var(--border-color);
  border-radius: var(--rounded-xl);
  overflow: hidden;
  transition: box-shadow 0.2s ease, border-color 0.2s ease, transform 0.2s ease;
  cursor: pointer;
  position: relative;
}
.element-card:hover {
  box-shadow: var(--shadow-lg);
  border-color: var(--accent-purple);
  transform: translateY(-2px);
}
.element-card.compare-selected {
  border-color: var(--secondary-purple);
  box-shadow: 0 0 0 2px rgba(109,49,194,0.2), var(--shadow-md);
}
.card-preview {
  width: 100%;
  height: 220px;
  border-bottom: 1px solid var(--border-color);
  background: var(--bg-white);
  overflow: hidden;
  position: relative;
}
.card-preview iframe {
  width: 200%;
  height: 200%;
  border: none;
  transform: scale(0.5);
  transform-origin: top left;
  pointer-events: none;
}
.card-body {
  padding: 16px 20px 20px;
}
.card-meta {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 8px;
  flex-wrap: wrap;
}
.badge {
  display: inline-block;
  padding: 2px 10px;
  border-radius: 10px;
  font-size: 11px;
  font-weight: 600;
  text-transform: capitalize;
}
.badge-works { background: #EDE9FE; color: #5B21B6; }
.badge-communicates { background: #DBEAFE; color: #1D4ED8; }
.badge-looks { background: #FCE7F3; color: #BE185D; }
.badge-behaves { background: #FEF3C7; color: #92400E; }
.badge-feels { background: #D1FAE5; color: #065F46; }
.badge-phase {
  background: var(--bg-light);
  color: var(--text-gray);
  font-weight: 500;
  text-transform: none;
}
.badge-priority-high {
  background: rgba(109,49,194,0.1);
  color: var(--secondary-purple);
  font-weight: 700;
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 0.04em;
}
.badge-priority-medium {
  background: var(--bg-light);
  color: var(--text-light-gray);
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 0.04em;
}
.card-title {
  font-size: 15px;
  font-weight: 700;
  color: var(--text-dark);
  line-height: 1.3;
  margin-bottom: 6px;
}
.card-rationale {
  font-size: 12px;
  color: var(--text-gray);
  line-height: 1.5;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}
.card-compare-check {
  position: absolute;
  top: 12px;
  right: 12px;
  width: 28px;
  height: 28px;
  border-radius: 50%;
  border: 2px solid var(--border-color);
  background: var(--bg-white);
  display: none;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  color: #fff;
  z-index: 2;
  cursor: pointer;
  transition: all 0.1s ease;
  box-shadow: var(--shadow-sm);
}
.compare-mode .card-compare-check {
  display: flex;
}
.card-compare-check.checked {
  background: var(--secondary-purple);
  border-color: var(--secondary-purple);
}

/* ===== MODAL ===== */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  z-index: 10000;
  display: none;
  align-items: flex-start;
  justify-content: center;
  padding: 40px 24px;
  overflow-y: auto;
  backdrop-filter: blur(4px);
}
.modal-overlay.visible {
  display: flex;
}
.modal {
  background: var(--bg-white);
  border-radius: 16px;
  max-width: 800px;
  width: 100%;
  box-shadow: var(--shadow-xl);
  overflow: hidden;
  animation: modalIn 0.25s cubic-bezier(0.16,1,0.3,1);
}
@keyframes modalIn {
  from { opacity: 0; transform: translateY(16px) scale(0.98); }
  to { opacity: 1; transform: translateY(0) scale(1); }
}
.modal-preview {
  width: 100%;
  height: 360px;
  background: var(--bg-light);
  border-bottom: 1px solid var(--border-color);
  overflow: hidden;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
}
.modal-preview iframe {
  width: 100%;
  height: 100%;
  border: none;
}
.modal-close {
  position: absolute;
  top: 16px;
  right: 16px;
  width: 36px;
  height: 36px;
  border-radius: 50%;
  border: none;
  background: rgba(255,255,255,0.9);
  color: var(--text-dark);
  font-size: 18px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: var(--shadow-sm);
  transition: background 0.1s ease;
  z-index: 2;
}
.modal-close:hover { background: #fff; }
.modal-content {
  padding: 28px 32px 32px;
}
.modal-header {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  margin-bottom: 24px;
}
.modal-title {
  font-size: 22px;
  font-weight: 700;
  color: var(--primary-purple);
  line-height: 1.25;
  flex: 1;
  margin-right: 16px;
}
.modal-badges {
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
  flex-shrink: 0;
}
.modal-section {
  margin-bottom: 24px;
}
.modal-section:last-child { margin-bottom: 0; }
.modal-section-title {
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--text-light-gray);
  margin-bottom: 10px;
}
.spec-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}
.spec-item {
  background: var(--bg-light);
  border-radius: var(--rounded-lg);
  padding: 12px 14px;
}
.spec-item-label {
  font-size: 11px;
  font-weight: 600;
  color: var(--text-light-gray);
  text-transform: uppercase;
  letter-spacing: 0.04em;
  margin-bottom: 4px;
}
.spec-item-value {
  font-size: 13px;
  color: var(--text-dark);
  line-height: 1.4;
}
.spec-item-value code {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 12px;
  background: rgba(109,49,194,0.06);
  padding: 1px 5px;
  border-radius: 4px;
  color: var(--secondary-purple);
}
.modal-rationale {
  background: var(--bg-off-white);
  border-radius: var(--rounded-lg);
  padding: 16px;
  font-size: 13px;
  color: var(--text-gray);
  line-height: 1.6;
  border-left: 3px solid var(--secondary-purple);
}
.before-after {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}
.ba-card {
  border-radius: var(--rounded-lg);
  padding: 14px;
  font-size: 12px;
  line-height: 1.5;
}
.ba-before {
  background: #fef2f2;
  color: #991b1b;
  border: 1px solid #fecaca;
}
.ba-after {
  background: #f0fdf4;
  color: #166534;
  border: 1px solid #bbf7d0;
}
.ba-label {
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  margin-bottom: 6px;
}
.copy-spec-grid {
  display: grid;
  gap: 8px;
}
.copy-item {
  display: flex;
  gap: 10px;
  font-size: 13px;
}
.copy-item-label {
  font-weight: 600;
  color: var(--text-light-gray);
  min-width: 70px;
  flex-shrink: 0;
  font-size: 12px;
}
.copy-item-value {
  color: var(--text-dark);
}

/* ===== COMPARE PANEL ===== */
.compare-bar {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: var(--primary-purple);
  color: #fff;
  padding: 14px 32px;
  display: none;
  align-items: center;
  justify-content: space-between;
  z-index: 9999;
  box-shadow: 0 -4px 20px rgba(0,0,0,0.2);
}
.compare-bar.visible { display: flex; }
.compare-bar-info {
  font-size: 14px;
  font-weight: 500;
}
.compare-bar-info strong {
  font-weight: 700;
}
.compare-bar-actions {
  display: flex;
  gap: 10px;
}
.compare-bar-btn {
  padding: 8px 20px;
  border-radius: var(--rounded-pill);
  border: none;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.1s ease;
  font-family: var(--font-inter);
}
.compare-bar-btn.primary {
  background: #fff;
  color: var(--primary-purple);
}
.compare-bar-btn.primary:hover { background: var(--bg-off-white); }
.compare-bar-btn.secondary {
  background: rgba(255,255,255,0.15);
  color: #fff;
}
.compare-bar-btn.secondary:hover { background: rgba(255,255,255,0.25); }

/* ===== COMPARE VIEW ===== */
.compare-view {
  display: none;
  max-width: 1280px;
  margin: 0 auto;
  padding: 0 32px 64px;
}
.compare-view.visible { display: block; }
.compare-view-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 24px;
}
.compare-view-title {
  font-size: 20px;
  font-weight: 700;
  color: var(--primary-purple);
}
.compare-back {
  padding: 8px 16px;
  border: 1.5px solid var(--border-color);
  border-radius: var(--rounded-pill);
  background: var(--bg-white);
  font-size: 13px;
  font-weight: 500;
  color: var(--text-gray);
  cursor: pointer;
  font-family: var(--font-inter);
  transition: all 0.1s ease;
}
.compare-back:hover {
  border-color: var(--accent-purple);
  color: var(--secondary-purple);
}
.compare-grid {
  display: grid;
  gap: 20px;
}
.compare-grid-2 { grid-template-columns: 1fr 1fr; }
.compare-grid-3 { grid-template-columns: 1fr 1fr 1fr; }
.compare-grid-4plus { grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); }
.compare-card {
  background: var(--bg-white);
  border: 1.5px solid var(--border-color);
  border-radius: var(--rounded-xl);
  overflow: hidden;
}
.compare-card-preview {
  width: 100%;
  height: 240px;
  border-bottom: 1px solid var(--border-color);
  overflow: hidden;
  background: var(--bg-white);
}
.compare-card-preview iframe {
  width: 100%;
  height: 100%;
  border: none;
}
.compare-card-body { padding: 16px; }
.compare-card-title {
  font-size: 14px;
  font-weight: 700;
  color: var(--primary-purple);
  margin-bottom: 6px;
}
.compare-card-desc {
  font-size: 12px;
  color: var(--text-gray);
  line-height: 1.4;
}

/* ===== EMPTY STATE ===== */
.empty-state {
  text-align: center;
  padding: 80px 32px;
  color: var(--text-light-gray);
}
.empty-state-icon {
  font-size: 48px;
  margin-bottom: 16px;
  opacity: 0.4;
}
.empty-state h3 {
  font-size: 18px;
  font-weight: 600;
  color: var(--text-gray);
  margin-bottom: 8px;
}
.empty-state p {
  font-size: 14px;
}

/* ===== RESPONSIVE ===== */
@media (max-width: 768px) {
  .lib-header { padding: 32px 20px; }
  .lib-header h1 { font-size: 24px; }
  .toolbar { padding: 16px 20px; }
  .grid-container { padding: 0 20px 48px; }
  .card-grid { grid-template-columns: 1fr; }
  .modal-content { padding: 20px; }
  .spec-grid { grid-template-columns: 1fr; }
  .before-after { grid-template-columns: 1fr; }
  .compare-grid-2, .compare-grid-3 { grid-template-columns: 1fr; }
  .modal-overlay { padding: 20px 12px; }
  .modal-preview { height: 260px; }
}

@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    transition-duration: 0.01ms !important;
  }
}
</style>
</head>
<body>

<!-- HEADER -->
<header class="lib-header">
  <div class="lib-header-inner">
    <h1>Library of Elements</h1>
    <div class="run-meta">Run <span>2026-02-12_1929</span> · Drew x Don't Make Me Think · <span>15 elements</span></div>
    <div class="search-bar">
      <span class="search-icon">&#x1F50D;</span>
      <input type="text" id="searchInput" placeholder="Search by name, category, phase..." autocomplete="off">
    </div>
  </div>
</header>

<!-- TOOLBAR -->
<div class="toolbar" id="toolbar">
  <div class="filter-group">
    <span class="filter-group-label">Category</span>
    <button class="chip" data-filter="category" data-value="works">Works <span class="chip-count">2</span></button>
    <button class="chip" data-filter="category" data-value="communicates">Communicates <span class="chip-count">3</span></button>
    <button class="chip" data-filter="category" data-value="looks">Looks <span class="chip-count">2</span></button>
    <button class="chip" data-filter="category" data-value="behaves">Behaves <span class="chip-count">5</span></button>
    <button class="chip" data-filter="category" data-value="feels">Feels <span class="chip-count">3</span></button>
  </div>
  <div class="filter-group">
    <span class="filter-group-label">Phase</span>
    <button class="chip" data-filter="phase" data-value="onboarding">Onboarding</button>
    <button class="chip" data-filter="phase" data-value="listing_creation">Listing</button>
    <button class="chip" data-filter="phase" data-value="proposal_mgmt">Proposals</button>
    <button class="chip" data-filter="phase" data-value="pricing">Pricing</button>
    <button class="chip" data-filter="phase" data-value="active_lease">Active Lease</button>
    <button class="chip" data-filter="phase" data-value="retention">Retention</button>
  </div>
  <div class="filter-group">
    <span class="filter-group-label">Priority</span>
    <button class="chip" data-filter="priority" data-value="high">High</button>
    <button class="chip" data-filter="priority" data-value="medium">Medium</button>
  </div>
  <div class="toolbar-spacer"></div>
  <span class="results-count" id="resultsCount">15 elements</span>
  <button class="compare-toggle" id="compareToggle" onclick="toggleCompareMode()">
    <span class="toggle-dot"></span> Compare
  </button>
</div>

<!-- CARD GRID -->
<div class="grid-container" id="gridContainer">
  <div class="card-grid" id="cardGrid"></div>
  <div class="empty-state" id="emptyState" style="display:none;">
    <div class="empty-state-icon">&#x1F50D;</div>
    <h3>No elements match</h3>
    <p>Try adjusting your search or filters</p>
  </div>
</div>

<!-- COMPARE VIEW -->
<div class="compare-view" id="compareView">
  <div class="compare-view-header">
    <div class="compare-view-title">Side-by-Side Comparison</div>
    <button class="compare-back" onclick="exitCompareView()">&#x2190; Back to grid</button>
  </div>
  <div class="compare-grid" id="compareGrid"></div>
</div>

<!-- COMPARE BAR -->
<div class="compare-bar" id="compareBar">
  <div class="compare-bar-info"><strong id="compareCount">0</strong> elements selected</div>
  <div class="compare-bar-actions">
    <button class="compare-bar-btn secondary" onclick="clearCompare()">Clear</button>
    <button class="compare-bar-btn primary" onclick="showCompareView()">Compare now</button>
  </div>
</div>

<!-- MODAL -->
<div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
  <div class="modal" onclick="event.stopPropagation()">
    <div class="modal-preview" id="modalPreview">
      <button class="modal-close" onclick="closeModal()">&#x2715;</button>
    </div>
    <div class="modal-content" id="modalContent"></div>
  </div>
</div>

<script>
// ===== DATA =====
const elements = [
  {
    "id": "ui-001",
    "name": "Self-Evidence Phase Entry Header",
    "category": "works",
    "phase": "onboarding",
    "priority": "high",
    "visual_spec": {"colors":{"heading":"#31135D","subtext":"#6b7280","background":"#ffffff"},"typography":{"heading_size":"28px","heading_weight":"700","subtext_size":"14px"}},
    "interaction_spec": {"states":{"default":"Static display — no interactive elements in the header itself","loading":"Heading-shaped skeleton placeholder at 28px height, subtext skeleton at 14px.","error":"If data fails to load, heading becomes: 'We couldn't load your details — try refreshing'"},"transitions":"Content fades in over 150ms with cubic-bezier(0.16, 1, 0.3, 1) easing.","micro_interactions":"None — the header is a static anchor. Confidence comes from stillness."},
    "copy_spec": {"headline":"Hey Drew — here's your Chelsea apartment","body":"Bryant set this up from your call. Let's confirm the details.","cta":"","tone":"Warm, personal, direct. Uses the host's first name and property location."},
    "html_css": "<div class=\"phase-entry-header\"><div class=\"agent-badge\"><div class=\"agent-avatar\">B</div><span class=\"agent-name\">From your call with Bryant</span></div><h1 class=\"anchor-heading\">Hey Drew — here's your Chelsea apartment</h1><p class=\"anchor-subtext\">Bryant set this up from your call. Let's confirm the details.</p></div><style>.phase-entry-header{padding:32px 24px;background:#ffffff;max-width:640px;font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif}.agent-badge{display:inline-flex;align-items:center;gap:8px;padding:6px 12px;background:rgb(252,250,255);border:1px solid #e5e7eb;border-radius:20px;margin-bottom:16px;font-size:13px;color:#6b7280}.agent-avatar{width:24px;height:24px;border-radius:50%;background:#31135D;color:#fff;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:600}.anchor-heading{font-size:28px;font-weight:700;color:#31135D;line-height:1.2;margin:0 0 8px 0;letter-spacing:-0.01em}.anchor-subtext{font-size:14px;color:#6b7280;line-height:1.5;margin:0 0 32px 0}</style>",
    "before_after": {"before":"Generic dashboard header: 'Welcome to Split Lease! Complete your onboarding to get started.' No personalization, no agent reference, no property context.","after":"Personalized continuation of the call: 'Hey Drew — here's your Chelsea apartment. Bryant set this up from your call.' Host sees recognition, not discovery."},
    "rationale": "Krug's First Law demands self-evidence at every phase entry. Drew's call ends with momentum — the first platform screen must sustain this by showing recognition rather than requiring orientation."
  },
  {
    "id": "ui-002",
    "name": "Billboard Proposal Card",
    "category": "communicates",
    "phase": "proposal_mgmt",
    "priority": "high",
    "visual_spec": {"colors":{"card_bg":"#ffffff","financial_section_bg":"rgb(252, 250, 255)","amount_color":"#31135D"},"typography":{"guest_name":"20px / 700 / Inter","amount":"24px / 600 / IBM Plex Mono"}},
    "interaction_spec": {"states":{"default":"Card displays all three areas. Accept button is primary (filled purple).","hover":"Only the Accept button has a hover state: background darkens to #251047.","success":"On Accept click, button transforms to checkmark with 'Confirmed' label. Spring animation (150ms overshoot)."},"transitions":"Optimistic confirmation: success state appears immediately on click.","micro_interactions":"Accept button scales to 0.98 on press, then springs to checkmark on release."},
    "copy_spec": {"headline":"Ariel & Amber","body":"Connecticut residents · Work in Manhattan · Weekday pied-à-terre · 4 months starting early March","cta":"Accept this proposal","tone":"Factual, scannable, no persuasion."},
    "html_css": "<div class=\"proposal-card\"><div class=\"proposal-section guests\"><span class=\"section-label\">The Guests</span><div class=\"guest-header\"><div class=\"guest-avatar\">A</div><div><div class=\"guest-name\">Ariel & Amber</div><div class=\"guest-context\">Connecticut · Work in Manhattan · Weekday pied-à-terre</div></div></div></div><div class=\"proposal-section earnings\"><span class=\"section-label\">Your Earnings</span><div class=\"amount-row\"><span class=\"amount\">$2,000</span><span class=\"amount-label\">/mo · guaranteed · 4 months</span></div><div class=\"amount-total\">$8,000 total</div></div><div class=\"proposal-section actions\"><button class=\"accept-btn\">Accept this proposal</button><div class=\"secondary-actions\"><a href=\"#\" class=\"action-link\">Counter</a><span class=\"action-divider\">·</span><a href=\"#\" class=\"action-link\">Decline</a></div></div></div><style>.proposal-card{max-width:480px;border:1px solid #e5e7eb;border-radius:12px;overflow:hidden;font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:#fff}.proposal-section{padding:24px}.proposal-section+.proposal-section{border-top:1px solid #e5e7eb}.section-label{display:block;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.05em;color:#9ca3af;margin-bottom:12px}.guests{background:#fff}.guest-header{display:flex;align-items:center;gap:12px}.guest-avatar{width:48px;height:48px;border-radius:50%;background:#31135D;color:#fff;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:600;flex-shrink:0}.guest-name{font-size:20px;font-weight:700;color:#1a1a1a;margin-bottom:4px}.guest-context{font-size:14px;color:#6b7280;line-height:1.5}.earnings{background:rgb(252,250,255)}.amount-row{display:flex;align-items:baseline;gap:6px;margin-bottom:4px}.amount{font-family:'IBM Plex Mono',monospace;font-size:24px;font-weight:600;color:#31135D}.amount-label{font-size:13px;color:#6b7280}.amount-total{font-size:13px;color:#6b7280}.actions{text-align:center}.accept-btn{width:100%;padding:14px 24px;background:rgb(109,49,194);color:#fff;border:none;border-radius:20px;font-size:16px;font-weight:600;cursor:pointer;transition:background 0.1s ease}.accept-btn:hover{background:#251047}.secondary-actions{margin-top:12px;font-size:13px}.action-link{color:#6b7280;text-decoration:none}.action-link:hover{color:rgb(109,49,194);text-decoration:underline}.action-divider{color:#e5e7eb;margin:0 8px}</style>",
    "before_after": {"before":"Proposal page shows a data table with columns: Guest Name, Start Date, End Date, Monthly Rate, Total, Status. No visual hierarchy.","after":"Three clearly defined areas ('The Guests,' 'Your Earnings,' 'Your Decision') that pass the $25,000 Pyramid test."},
    "rationale": "Krug's billboard hierarchy demands that Drew's scanning eye land on the primary information within 2 seconds. The three-area layout mirrors Bryant's disclosure order in the call."
  },
  {
    "id": "ui-003",
    "name": "Confirmation Pricing Card",
    "category": "looks",
    "phase": "pricing",
    "priority": "high",
    "visual_spec": {"colors":{"card_bg":"rgb(252, 250, 255)","amount_color":"#31135D","confirm_btn_bg":"rgb(109, 49, 194)"},"typography":{"amount":"28px / 600 / IBM Plex Mono","provenance":"13px / 400 / Inter"}},
    "interaction_spec": {"states":{"default":"Read-only display with Confirm button. No input fields.","success":"Button transforms to '✓ Confirmed' with spring animation. Card border shifts to subtle purple left accent.","editing":"If host clicks 'Change', the amount transforms into an editable field."},"transitions":"Optimistic confirmation: success state appears instantly on click.","micro_interactions":"Provenance text fades in 200ms after the amount appears on page load."},
    "copy_spec": {"headline":"$2,000","body":"/month · from your call with Bryant","cta":"Confirm","tone":"Precise, authoritative, calming. Mono font signals financial data."},
    "html_css": "<div class=\"pricing-confirm\"><div class=\"pricing-amount-row\"><span class=\"pricing-amount\">$2,000</span><span class=\"pricing-period\">/month</span></div><p class=\"pricing-provenance\">From your call with Bryant · Guaranteed</p><button class=\"pricing-confirm-btn\">Confirm</button><a href=\"#\" class=\"pricing-change\">Need to change this?</a></div><style>.pricing-confirm{max-width:400px;background:rgb(252,250,255);border-radius:12px;padding:32px 24px;text-align:center;font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif}.pricing-amount-row{display:flex;align-items:baseline;justify-content:center;gap:4px;margin-bottom:4px}.pricing-amount{font-family:'IBM Plex Mono',monospace;font-size:28px;font-weight:600;color:#31135D}.pricing-period{font-size:16px;color:#31135D;font-weight:400}.pricing-provenance{font-size:13px;color:#9ca3af;margin:0 0 24px 0}.pricing-confirm-btn{padding:14px 48px;background:rgb(109,49,194);color:#fff;border:none;border-radius:20px;font-size:16px;font-weight:600;cursor:pointer;transition:background 0.1s ease}.pricing-confirm-btn:hover{background:#251047}.pricing-change{display:block;margin-top:12px;font-size:12px;color:#6b7280;text-decoration:none}.pricing-change:hover{color:rgb(109,49,194);text-decoration:underline}</style>",
    "before_after": {"before":"Pricing wizard step with an editable text input field showing '$2,000', a nightly rate calculator, a fee breakdown table. The editable field suggests the amount is negotiable.","after":"Read-only confirmation card with mono-font amount, provenance annotation, single Confirm button. Communicates 'this is settled fact.'"},
    "rationale": "Drew confirms his price in 3 seconds on the call. An editable field invites deliberation where none is needed. The mono font signals precision per the taste model."
  },
  {
    "id": "ui-004",
    "name": "Conversational Wizard Step with Compressed Summary",
    "category": "behaves",
    "phase": "listing_creation",
    "priority": "high",
    "visual_spec": {"colors":{"completed_summary_bg":"#f9fafb","completed_check":"rgb(109, 49, 194)","active_border_left":"rgb(109, 49, 194)"},"typography":{"summary_text":"13px / 500 / Inter","step_heading":"20px / 700 / Inter"}},
    "interaction_spec": {"states":{"default":"Active step shows form at full size. Completed steps are compressed to summaries. Future steps not visible.","transitioning":"On step completion, outgoing step compresses upward (300ms) while incoming step expands from below (300ms, spring easing)."},"transitions":"Compression uses cubic-bezier(0.16, 1, 0.3, 1). Expansion uses cubic-bezier(0.34, 1.56, 0.64, 1).","micro_interactions":"Completed step checkmark appears with a quick scale-up (100ms). Progress bar segment fills smoothly (200ms)."},
    "copy_spec": {"headline":"Add your photos","body":"These help guests picture themselves in your space.","cta":"Next: Review & publish","tone":"Forward-looking, concise."},
    "html_css": "<div class=\"wizard-flow\"><div class=\"progress-bar\"><div class=\"progress-fill\" style=\"width:66%\"></div></div><div class=\"completed-step\"><span class=\"step-check\">✓</span><span class=\"step-summary\">1BR · Chelsea · $2,000/mo</span></div><div class=\"completed-step\"><span class=\"step-check\">✓</span><span class=\"step-summary\">Furnished · Washer/dryer · Doorman</span></div><div class=\"completed-step\"><span class=\"step-check\">✓</span><span class=\"step-summary\">Flexible lease · Weekday stays</span></div><div class=\"active-step\"><h2 class=\"step-heading\">Add your photos</h2><p class=\"step-body\">These help guests picture themselves in your space. You mentioned having more pictures ready.</p><div class=\"upload-zone\"><span class=\"upload-text\">Drop photos here or browse</span></div><button class=\"step-next-btn\">Next: Review & publish</button></div></div><style>.wizard-flow{max-width:540px;font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif}.progress-bar{height:4px;background:#e5e7eb;border-radius:4px;margin-bottom:24px;overflow:hidden}.progress-fill{height:100%;background:rgb(109,49,194);border-radius:4px;transition:width 0.3s cubic-bezier(0.16,1,0.3,1)}.completed-step{display:flex;align-items:center;gap:8px;padding:10px 16px;background:#f9fafb;border-radius:8px;margin-bottom:4px;font-size:13px;color:#6b7280;cursor:pointer;transition:background 0.15s ease}.completed-step:hover{background:#f3f4f6}.step-check{color:rgb(109,49,194);font-weight:700;font-size:14px;flex-shrink:0}.step-summary{font-weight:500}.active-step{border-left:3px solid rgb(109,49,194);padding:24px;margin-top:16px;background:#fff;border-radius:0 12px 12px 0}.step-heading{font-size:20px;font-weight:700;color:#1a1a1a;margin:0 0 8px 0}.step-body{font-size:14px;color:#6b7280;margin:0 0 20px 0;line-height:1.5}.upload-zone{border:2px dashed #e5e7eb;border-radius:12px;padding:40px 24px;text-align:center;margin-bottom:20px;transition:border-color 0.15s ease;cursor:pointer}.upload-zone:hover{border-color:rgb(109,49,194)}.upload-text{font-size:14px;color:#9ca3af}.step-next-btn{width:100%;padding:14px 24px;background:rgb(109,49,194);color:#fff;border:none;border-radius:20px;font-size:16px;font-weight:600;cursor:pointer;transition:background 0.1s ease}.step-next-btn:hover{background:#251047}</style>",
    "before_after": {"before":"Traditional multi-step wizard with 'Step 4 of 6' counter, hard cuts between steps, no visible trail of prior answers.","after":"Conversational flow with compressed summaries stacking above the active step. Drew sees his prior answers accumulating."},
    "rationale": "Bryant's call flows as continuous conversation with no hard breaks. Compressed summaries maintain context across steps."
  },
  {
    "id": "ui-005",
    "name": "Guaranteed Rent Status Display",
    "category": "feels",
    "phase": "active_lease",
    "priority": "high",
    "visual_spec": {"colors":{"card_bg":"rgb(252, 250, 255)","amount_color":"#31135D","status_color":"rgb(109, 49, 194)"},"typography":{"amount":"32px / 700 / IBM Plex Mono","status_label":"13px / 600 / Inter"}},
    "interaction_spec": {"states":{"default":"Shows the most recent guaranteed payment as settled fact.","expanded":"Clicking 'See details' reveals collapsible section with payment history."},"transitions":"Amount appears without animation — it's just there, like a bank balance.","micro_interactions":"None on the amount itself. Financial data should feel settled and still."},
    "copy_spec": {"headline":"$2,000","body":"Paid on Feb 1 · Your guaranteed rent","cta":"See payment details","tone":"Precise, authoritative, calming. Uses 'guaranteed' as an adjective."},
    "html_css": "<div class=\"rent-status\"><div class=\"rent-amount\">$2,000</div><div class=\"rent-status-line\"><span class=\"status-check\">✓</span><span class=\"status-text\">Paid on Feb 1 · Your guaranteed rent</span></div><div class=\"rent-divider\"></div><div class=\"rent-cumulative\"><span class=\"cumulative-amount\">$6,000</span><span class=\"cumulative-label\"> earned since March</span></div><a href=\"#\" class=\"rent-details-link\">See payment details</a></div><style>.rent-status{max-width:400px;background:rgb(252,250,255);border-radius:12px;padding:24px;text-align:center;font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif}.rent-amount{font-family:'IBM Plex Mono',monospace;font-size:32px;font-weight:700;color:#31135D;margin-bottom:4px}.rent-status-line{display:flex;align-items:center;justify-content:center;gap:6px;margin-bottom:16px}.status-check{color:rgb(109,49,194);font-weight:700}.status-text{font-size:13px;color:#6b7280;font-weight:500}.rent-divider{height:1px;background:#e5e7eb;margin:16px 0}.rent-cumulative{margin-bottom:12px}.cumulative-amount{font-family:'IBM Plex Mono',monospace;font-size:16px;font-weight:600;color:#374151}.cumulative-label{font-size:14px;color:#6b7280}.rent-details-link{font-size:12px;color:#6b7280;text-decoration:none}.rent-details-link:hover{color:rgb(109,49,194);text-decoration:underline}</style>",
    "before_after": {"before":"Payment dashboard showing: Base rent $2,000 | Split Lease fee -$150 | Net payout: $1,850 | Status: Processing (3-5 business days). First thing Drew sees is a deduction.","after":"Guarantee-first display: '$2,000 · Paid on Feb 1 · Your guaranteed rent.' Deductions available via 'See details' but never compete with the guarantee."},
    "rationale": "Drew accepts the guarantee in four words on the call. The platform must sustain this calm certainty at every financial touchpoint. Mono typography signals precision and trust."
  },
  {
    "id": "ui-006",
    "name": "Mindless Choice Binary Selector",
    "category": "communicates",
    "phase": "listing_creation",
    "priority": "medium",
    "visual_spec": {"colors":{"option_bg":"#ffffff","option_selected_bg":"rgb(252, 250, 255)","option_selected_border":"rgb(109, 49, 194)"},"typography":{"question":"18px / 600 / Inter","option_label":"16px / 600 / Inter"}},
    "interaction_spec": {"states":{"default":"Options display as outlined cards with equal visual weight.","selected":"Selected option gets tinted background + purple border + check icon. Other options fade to 50% opacity."},"transitions":"Selection is instant (no animation delay). Flow auto-advances after 300ms.","micro_interactions":"Check icon scales in with spring easing. Each choice takes under 2 seconds."},
    "copy_spec": {"headline":"Is this the whole apartment?","body":"","cta":"","tone":"Conversational, yes/no framing. Mirrors how Bryant asked questions in the call."},
    "html_css": "<div class=\"binary-choice\"><h3 class=\"choice-question\">Is this the whole apartment?</h3><div class=\"choice-options\"><button class=\"choice-option selected\"><span class=\"option-check\">✓</span><div class=\"option-content\"><span class=\"option-label\">Yes, the entire place</span><span class=\"option-desc\">Guests have the whole apartment to themselves</span></div></button><button class=\"choice-option\"><div class=\"option-content\"><span class=\"option-label\">Just a room</span><span class=\"option-desc\">Guests use a private room in a shared space</span></div></button></div></div><style>.binary-choice{max-width:480px;font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif}.choice-question{font-size:18px;font-weight:600;color:#1a1a1a;margin:0 0 16px 0}.choice-options{display:flex;flex-direction:column;gap:8px}.choice-option{display:flex;align-items:center;gap:12px;padding:16px 20px;background:#fff;border:1.5px solid #e5e7eb;border-radius:12px;cursor:pointer;text-align:left;transition:all 0.1s ease;width:100%}.choice-option:hover{background:rgb(252,250,255);border-color:rgb(140,104,238)}.choice-option.selected{background:rgb(252,250,255);border-color:rgb(109,49,194)}.option-check{color:rgb(109,49,194);font-weight:700;font-size:16px;flex-shrink:0}.option-content{display:flex;flex-direction:column;gap:2px}.option-label{font-size:16px;font-weight:600;color:#1a1a1a}.option-desc{font-size:13px;color:#6b7280}</style>",
    "before_after": {"before":"A dropdown labeled 'Property Type' with 8 options. Drew must click, scan 8 options, and select one.","after":"A single conversational question with 2 large tappable options. Drew taps one in under 2 seconds."},
    "rationale": "Krug Ch. 4: 'Why users like mindless choices.' Bryant asks binary questions in the call. The platform must decompose complex selections into conversational yes/no questions."
  },
  {
    "id": "ui-007",
    "name": "Inline Field Validation with Warm Warning",
    "category": "behaves",
    "phase": "listing_creation",
    "priority": "high",
    "visual_spec": {"colors":{"focus_border":"rgb(109, 49, 194)","warn_border":"#c17a28","warn_text":"#92620E","warn_bg":"#fef3e2"},"typography":{"input_text":"14px / 400 / Inter","warn_message":"12px / 400 / Inter"}},
    "interaction_spec": {"states":{"default":"Input with light border. No validation visible.","focus":"Border shifts to purple with subtle glow.","warning":"On blur with invalid input, border shifts to warm amber. Single-line message below."},"transitions":"Warning fades in with 150ms ease-out on blur. Fades out when corrected.","micro_interactions":"If Submit with errors, page scrolls to first error field and message pulses twice."},
    "copy_spec": {"headline":"","body":"","cta":"","tone":"Conversational and helpful, not punitive. 'We need this to create your listing' rather than 'Error: Required field.'"},
    "html_css": "<div class=\"form-field\"><label class=\"field-label\">Listing title</label><input type=\"text\" class=\"field-input\" placeholder=\"e.g., Comfortable Chelsea 1BR\" value=\"\"><div class=\"field-warning\"><span class=\"warning-icon\">!</span><span class=\"warning-text\">We need this to create your listing</span></div></div><div class=\"form-field valid\"><label class=\"field-label\">Monthly rent</label><input type=\"text\" class=\"field-input\" value=\"$2,000\"><p class=\"field-provenance\">From your call with Bryant</p></div><style>.form-field{max-width:480px;margin-bottom:20px;font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif}.field-label{display:block;font-size:13px;font-weight:600;color:#1a1a1a;margin-bottom:6px}.field-input{width:100%;padding:12px 16px;border:1.5px solid #e5e7eb;border-radius:8px;font-size:14px;color:#1a1a1a;background:#fff;transition:border-color 0.15s ease,box-shadow 0.15s ease;box-sizing:border-box}.field-input:focus{outline:none;border-color:rgb(109,49,194);box-shadow:0 0 0 3px rgba(109,49,194,0.1)}.field-warning{display:flex;align-items:center;gap:6px;margin-top:6px;padding:6px 10px;background:#fef3e2;border-radius:6px;animation:fadeIn 0.15s ease-out}.warning-icon{color:#c17a28;font-weight:700;font-size:13px}.warning-text{font-size:12px;color:#92620E}.form-field.valid .field-input{border-color:#e5e7eb}.field-provenance{font-size:12px;color:#9ca3af;margin:6px 0 0 0}@keyframes fadeIn{from{opacity:0;transform:translateY(-4px)}to{opacity:1;transform:translateY(0)}}</style>",
    "before_after": {"before":"Form validates only on submit. Drew fills 6 fields, clicks Submit, sees a red banner: 'Error: Please fix 2 errors.' Must scroll to find which fields are wrong.","after":"Inline validation on blur: warm amber message appears immediately below the problem field. Pre-filled fields show provenance. No validation fires on submit."},
    "rationale": "Drew satisfices — he won't review the form before submitting. Post-submission errors force re-finding and re-contextualizing problems. Inline on-blur validation catches errors at the moment of maximum relevance."
  },
  {
    "id": "ui-008",
    "name": "Bryant Escape Hatch Button",
    "category": "behaves",
    "phase": "listing_creation",
    "priority": "medium",
    "visual_spec": {"colors":{"avatar_bg":"#31135D","panel_bg":"#ffffff","send_btn_bg":"rgb(109, 49, 194)"},"typography":{"label":"13px / 500 / Inter","input":"14px / 400 / Inter"}},
    "interaction_spec": {"states":{"default":"Small avatar circle with 'B' initial. Visually recessive.","hover":"Avatar gains larger shadow and tooltip: 'Message Bryant'","expanded":"Panel opens upward with spring easing (200ms). Shows context line and message input."},"transitions":"Expansion: cubic-bezier(0.34, 1.56, 0.64, 1) over 200ms. Collapse: 150ms.","micro_interactions":"During onboarding, avatar subtly pulses once after 5 seconds with tooltip: 'Bryant is here if you need help.'"},
    "copy_spec": {"headline":"","body":"You're on: Listing Photos · Drew's Chelsea apartment","cta":"Send to Bryant","tone":"Quick and casual — like starting a text thread."},
    "html_css": "<div class=\"bryant-escape\" style=\"position:relative;height:200px\"><div class=\"bryant-panel\"><div class=\"panel-context\">You're on: Listing Photos</div><div class=\"panel-input-row\"><input type=\"text\" class=\"panel-input\" placeholder=\"Ask Bryant anything...\"><button class=\"panel-send\">Send</button></div></div><button class=\"bryant-avatar\" style=\"position:absolute;bottom:0;right:0\">B</button></div><style>.bryant-escape{max-width:360px;font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif}.bryant-avatar{width:48px;height:48px;border-radius:50%;background:#31135D;color:#fff;border:none;font-size:18px;font-weight:600;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,0.15);transition:box-shadow 0.15s ease,transform 0.15s ease}.bryant-avatar:hover{box-shadow:0 4px 16px rgba(49,19,93,0.35);transform:scale(1.05)}.bryant-panel{position:absolute;bottom:56px;right:0;width:320px;background:#fff;border-radius:12px;box-shadow:0 4px 16px rgba(49,19,93,0.35);padding:16px;display:flex;flex-direction:column;gap:12px}.panel-context{font-size:12px;color:#9ca3af;padding-bottom:8px;border-bottom:1px solid #f3f4f6}.panel-input-row{display:flex;gap:8px}.panel-input{flex:1;padding:10px 12px;border:1.5px solid #e5e7eb;border-radius:8px;font-size:14px}.panel-input:focus{outline:none;border-color:rgb(109,49,194)}.panel-send{padding:10px 16px;background:rgb(109,49,194);color:#fff;border:none;border-radius:8px;font-size:13px;font-weight:600;cursor:pointer;white-space:nowrap}.panel-send:hover{background:#251047}</style>",
    "before_after": {"before":"No in-platform escape hatch. When Drew gets confused, he must leave entirely, open his phone, find Bryant's contact, compose a text, and wait.","after":"Persistent Bryant avatar in the corner — always one tap away. Opens a quick message panel pre-filled with current screen context."},
    "rationale": "Drew's call ends with Bryant offering himself as fallback. If texting Bryant outside the platform works, Drew will never use the platform. The in-context escape hatch must be easier than texting."
  },
  {
    "id": "ui-009",
    "name": "Area-Separated Dashboard Sections",
    "category": "communicates",
    "phase": "active_lease",
    "priority": "medium",
    "visual_spec": {"colors":{"area_2_bg":"rgb(252, 250, 255)","heading_color":"#1a1a1a","status_active":"rgb(109, 49, 194)"},"typography":{"section_label":"11px / 600 / Inter / uppercase","area_heading":"16px / 600 / Inter"}},
    "interaction_spec": {"states":{"default":"All three areas visible simultaneously. No collapse/expand.","loading":"Each area shows its own skeleton. Data fills per-area."},"transitions":"Data appears without entrance animation on return visits.","micro_interactions":"Status badges have a subtle purple dot animation on first page load only."},
    "copy_spec": {"headline":"Your Chelsea apartment · Ariel & Amber · Month 3","body":"","cta":"","tone":"Contextual, specific, quietly attentive."},
    "html_css": "<div class=\"dashboard\"><h1 class=\"dash-heading\">Your Chelsea apartment</h1><p class=\"dash-subheading\">Ariel & Amber · Month 3 of 4</p><div class=\"dash-area area-guests\"><span class=\"area-label\">Who's Staying</span><div class=\"guest-row\"><div class=\"guest-dot active\"></div><span class=\"guest-name-text\">Ariel — checked in</span></div><div class=\"guest-row\"><div class=\"guest-dot active\"></div><span class=\"guest-name-text\">Amber — checked in</span></div></div><div class=\"dash-area area-payments\"><span class=\"area-label\">Am I Getting Paid</span><div class=\"payment-row\"><span class=\"payment-amount\">$2,000</span><span class=\"payment-status\">✓ Paid Feb 1</span></div><div class=\"payment-cumulative\">$6,000 earned since March · guaranteed</div></div><div class=\"dash-area area-upcoming\"><span class=\"area-label\">What's Coming Up</span><div class=\"upcoming-item\">Next payment: Mar 1</div><div class=\"upcoming-item\">Lease ends: Jun 30</div></div></div><style>.dashboard{max-width:540px;font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif}.dash-heading{font-size:24px;font-weight:700;color:#1a1a1a;margin:0 0 4px 0}.dash-subheading{font-size:14px;color:#6b7280;margin:0 0 24px 0}.dash-area{padding:20px;border-radius:12px;margin-bottom:4px}.area-guests{background:#fff;border:1px solid #e5e7eb}.area-payments{background:rgb(252,250,255)}.area-upcoming{background:#fff;border:1px solid #e5e7eb}.area-label{display:block;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.05em;color:#9ca3af;margin-bottom:12px}.guest-row{display:flex;align-items:center;gap:8px;margin-bottom:6px;font-size:14px;color:#374151}.guest-dot{width:8px;height:8px;border-radius:50%}.guest-dot.active{background:rgb(109,49,194)}.payment-row{display:flex;align-items:baseline;gap:8px;margin-bottom:8px}.payment-amount{font-family:'IBM Plex Mono',monospace;font-size:20px;font-weight:600;color:#31135D}.payment-status{font-size:13px;color:rgb(109,49,194);font-weight:500}.payment-cumulative{font-size:13px;color:#6b7280}.upcoming-item{font-size:14px;color:#374151;margin-bottom:6px;padding-left:16px;position:relative}.upcoming-item::before{content:'→';position:absolute;left:0;color:#9ca3af}</style>",
    "before_after": {"before":"Generic navigation-focused dashboard: 'Dashboard — Your Listings (1) · Payments · Messages · Settings.' Forces Drew to choose before seeing information.","after":"Data-focused dashboard with three nameable areas. Drew's specific data is the first thing he sees — not navigation chrome."},
    "rationale": "Krug's $25,000 Pyramid test demands nameable areas. The three areas map to Drew's three recurring questions: guests? money? timeline?"
  },
  {
    "id": "ui-010",
    "name": "Optimistic Accept Button with Spring Checkmark",
    "category": "behaves",
    "phase": "proposal_mgmt",
    "priority": "high",
    "visual_spec": {"colors":{"default_bg":"rgb(109, 49, 194)","hover_bg":"#251047","text_color":"#ffffff"},"typography":{"button_text":"16px / 600 / Inter"}},
    "interaction_spec": {"states":{"default":"Purple pill button: 'Accept this proposal'","success":"INSTANT on click: checkmark scales in with spring easing (150ms), text becomes '✓ Confirmed'. No loading spinner.","error_rollback":"Checkmark morphs to attention icon. Inline message: 'Something went wrong — Try again'. No modal."},"transitions":"Default → Success: 0ms perceived latency. Spring animation provides haptic-like feedback.","micro_interactions":"Checkmark overshoots slightly (1.56 spring factor) then settles. Button disabled after first click."},
    "copy_spec": {"headline":"","body":"","cta":"Accept this proposal → ✓ Confirmed","tone":"Action-oriented, then reassuring. Mirrors Drew's call pattern: action → acknowledgment with no gap."},
    "html_css": "<div class=\"accept-demo\"><button class=\"accept-btn-demo\" onclick=\"this.classList.add('confirmed');this.disabled=true\"><span class=\"btn-label\">Accept this proposal</span><span class=\"btn-confirmed\">✓ Confirmed</span></button></div><style>.accept-demo{max-width:400px;font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif}.accept-btn-demo{width:100%;padding:14px 32px;background:rgb(109,49,194);color:#fff;border:none;border-radius:20px;font-size:16px;font-weight:600;cursor:pointer;transition:background 0.1s ease,transform 0.1s ease;position:relative;overflow:hidden}.accept-btn-demo:hover{background:#251047}.accept-btn-demo:active{transform:scale(0.98)}.accept-btn-demo .btn-confirmed{display:none}.accept-btn-demo.confirmed{background:rgb(109,49,194);cursor:default;animation:confirmPulse 0.3s cubic-bezier(0.34,1.56,0.64,1)}.accept-btn-demo.confirmed .btn-label{display:none}.accept-btn-demo.confirmed .btn-confirmed{display:inline}@keyframes confirmPulse{0%{transform:scale(0.95)}50%{transform:scale(1.02)}100%{transform:scale(1)}}</style>",
    "before_after": {"before":"Click Accept → Loading spinner 1-2s → 'Are you sure?' dialog → Click Yes → Another spinner → Success page. Total: 5-8 seconds, 2 question marks.","after":"Click Accept → Instant checkmark with spring animation → 'Confirmed'. Total: 0 seconds perceived latency. Zero question marks."},
    "rationale": "Drew's certainty is 100%. A loading spinner contradicts this. Optimistic UI eliminates the question mark by showing the outcome at the speed of the decision."
  },
  {
    "id": "ui-011",
    "name": "Clickability-Isolated Action Area",
    "category": "looks",
    "phase": "proposal_mgmt",
    "priority": "medium",
    "visual_spec": {"colors":{"primary_btn_bg":"rgb(109, 49, 194)","secondary_link_color":"#6b7280","info_text_color":"#374151"},"typography":{"primary_btn":"16px / 600 / Inter","secondary_link":"13px / 400 / Inter"}},
    "interaction_spec": {"states":{"hover_button":"Background darkens to #251047, cursor: pointer.","hover_link":"Color shifts to purple, underline appears.","hover_info":"NO response. Cursor remains default. Static content is static."},"transitions":"Hover on button: instant entry, 150ms fade-out.","micro_interactions":"Focus ring (2px solid rgb(109,49,194)) on keyboard tab navigation. Never suppressed."},
    "copy_spec": {"headline":"","body":"","cta":"Accept this proposal","tone":"The action area speaks through visual affordances, not words."},
    "html_css": "<div class=\"action-area\"><div class=\"action-info\"><span class=\"info-item\">4 months · Starting early March</span></div><button class=\"action-primary\">Accept this proposal</button><div class=\"action-secondary\"><a href=\"#\" class=\"action-text-link\">Counter with different terms</a><span class=\"link-sep\">·</span><a href=\"#\" class=\"action-text-link\">Decline</a></div></div><style>.action-area{max-width:480px;padding:24px;font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;text-align:center;border-top:1px solid #e5e7eb}.action-info{margin-bottom:16px}.info-item{font-size:14px;color:#374151}.action-primary{width:100%;padding:14px 32px;background:rgb(109,49,194);color:#fff;border:none;border-radius:20px;font-size:16px;font-weight:600;cursor:pointer;transition:background 0.1s ease,transform 0.1s ease}.action-primary:hover{background:#251047}.action-primary:active{transform:scale(0.98)}.action-primary:focus-visible{outline:2px solid rgb(109,49,194);outline-offset:2px}.action-secondary{margin-top:12px;font-size:13px}.action-text-link{color:#6b7280;text-decoration:none;transition:color 0.1s ease}.action-text-link:hover{color:rgb(109,49,194);text-decoration:underline}.link-sep{color:#e5e7eb;margin:0 8px}</style>",
    "before_after": {"before":"Three buttons of equal size and color: [Accept] [Counter] [Decline]. Info text uses the same purple as buttons, creating false clickability signals.","after":"Only Accept is purple-filled. Counter and Decline are gray text links. Info text has no hover response. Drew finds exactly one 'click me' signal."},
    "rationale": "Krug Ch. 3: 'it's important to make it obvious what's clickable and what's not.' The Hatch problem maps directly to the Split Lease purple palette risk."
  },
  {
    "id": "ui-012",
    "name": "Renewal Extension Card",
    "category": "feels",
    "phase": "retention",
    "priority": "medium",
    "visual_spec": {"colors":{"track_record_bg":"rgb(252, 250, 255)","earnings_color":"#31135D","extend_btn_bg":"rgb(109, 49, 194)"},"typography":{"heading":"20px / 700 / Inter","earnings":"24px / 700 / IBM Plex Mono"}},
    "interaction_spec": {"states":{"default":"Card shows track record and extend button. No urgency indicators.","success":"On click, button transforms to '✓ Extended' with spring animation."},"transitions":"Card appears with calm 200ms fade-in. No pop-up, no alert.","micro_interactions":"Earnings figure counts up gently (800ms) on first view. Only once — subsequent views show static number."},
    "copy_spec": {"headline":"Ariel & Amber want to stay","body":"$8,000 earned · 4 months · Zero issues","cta":"Extend 4 months","tone":"Reflective, evidence-based, gently encouraging. Uses 'extend' (Drew's word), not 'renew.'"},
    "html_css": "<div class=\"renewal-card\"><h2 class=\"renewal-heading\">Ariel & Amber want to stay</h2><div class=\"renewal-track\"><div class=\"track-metric\"><span class=\"metric-value\">$8,000</span><span class=\"metric-label\">earned</span></div><div class=\"track-metric\"><span class=\"metric-value\">4 months</span><span class=\"metric-label\">completed</span></div><div class=\"track-metric\"><span class=\"metric-value\">Zero</span><span class=\"metric-label\">issues</span></div></div><button class=\"renewal-extend\">Extend 4 months</button><a href=\"#\" class=\"renewal-details\">Review terms first</a></div><style>.renewal-card{max-width:480px;background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:24px;text-align:center;font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif}.renewal-heading{font-size:20px;font-weight:700;color:#1a1a1a;margin:0 0 16px 0}.renewal-track{display:flex;justify-content:center;gap:24px;padding:16px;background:rgb(252,250,255);border-radius:8px;margin-bottom:20px}.track-metric{display:flex;flex-direction:column;align-items:center;gap:4px}.metric-value{font-family:'IBM Plex Mono',monospace;font-size:18px;font-weight:700;color:#31135D}.metric-label{font-size:12px;color:#6b7280}.renewal-extend{width:100%;padding:14px 32px;background:rgb(109,49,194);color:#fff;border:none;border-radius:20px;font-size:16px;font-weight:600;cursor:pointer;transition:background 0.1s ease}.renewal-extend:hover{background:#251047}.renewal-details{display:block;margin-top:12px;font-size:12px;color:#6b7280;text-decoration:none}.renewal-details:hover{color:rgb(109,49,194);text-decoration:underline}</style>",
    "before_after": {"before":"Formal renewal process: 'To renew, please review the updated Host Agreement (v3.2), confirm your rate, and digitally sign the new lease.' Multiple steps, legal language.","after":"Continuation card: 'Ariel & Amber want to stay. $8,000 earned · 4 months · Zero issues. Extend 4 months?' One button. Evidence before the ask."},
    "rationale": "Drew's call establishes 'maybe the ability to extend' — openness without commitment. The platform must convert 'maybe' to 'yes' through evidence, not process."
  },
  {
    "id": "ui-013",
    "name": "Pre-Filled Confirmation Field with Provenance",
    "category": "feels",
    "phase": "listing_creation",
    "priority": "medium",
    "visual_spec": {"colors":{"field_bg":"rgb(252, 250, 255)","value_color":"#1a1a1a","provenance_color":"#9ca3af"},"typography":{"value":"16px / 600 / Inter","provenance":"12px / 400 / Inter"}},
    "interaction_spec": {"states":{"default":"Read-only display with tinted background. Visually communicates 'this is already done.'","editing":"Clicking 'Change' transforms: background becomes white, border appears, value becomes editable."},"transitions":"Read-only → Editing: 200ms fade. The transformation is deliberate.","micro_interactions":"Provenance annotation fades in 200ms after the value appears."},
    "copy_spec": {"headline":"","body":"From your call with Bryant","cta":"Change","tone":"Transparent, attributive. The provenance annotation earns the host's satisficing."},
    "html_css": "<div class=\"prefilled-field\"><label class=\"pf-label\">Location</label><div class=\"pf-display\"><div class=\"pf-value-row\"><span class=\"pf-value\">Chelsea, New York</span><a href=\"#\" class=\"pf-change\">Change</a></div><span class=\"pf-provenance\">From your call with Bryant</span></div></div><div class=\"prefilled-field\"><label class=\"pf-label\">Security deposit</label><div class=\"pf-display\"><div class=\"pf-value-row\"><span class=\"pf-value\">$1,000</span><a href=\"#\" class=\"pf-change\">Change</a></div><span class=\"pf-provenance\">Your preference, confirmed</span></div></div><style>.prefilled-field{max-width:480px;margin-bottom:16px;font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif}.pf-label{display:block;font-size:13px;font-weight:600;color:#1a1a1a;margin-bottom:6px}.pf-display{background:rgb(252,250,255);border-radius:8px;padding:14px 16px}.pf-value-row{display:flex;justify-content:space-between;align-items:center}.pf-value{font-size:16px;font-weight:600;color:#1a1a1a}.pf-change{font-size:12px;color:#6b7280;text-decoration:none}.pf-change:hover{color:rgb(109,49,194);text-decoration:underline}.pf-provenance{display:block;font-size:12px;color:#9ca3af;margin-top:4px}</style>",
    "before_after": {"before":"Standard editable text input with blinking cursor. Looks identical to empty fields. The editable styling signals 'you should change this.'","after":"Tinted read-only display with no input border. 'From your call with Bryant' provenance below. The visual treatment signals 'this is already done — just move on.'"},
    "rationale": "Drew satisfices on every default. The provenance annotation transforms satisficing from lazy acceptance into informed confirmation."
  },
  {
    "id": "ui-014",
    "name": "Scan-Speed Skeleton Loading Pattern",
    "category": "behaves",
    "phase": "proposal_mgmt",
    "priority": "medium",
    "visual_spec": {"colors":{"skeleton_bg":"#f3f4f6","skeleton_shimmer":"linear-gradient(90deg, #f3f4f6 25%, #e5e7eb 50%, #f3f4f6 75%)"},"typography":{}},
    "interaction_spec": {"states":{"loading":"Skeleton structure renders immediately. Heading-shaped placeholder, body-shaped placeholder, button-shaped placeholder. Shimmer animation.","loaded":"Data fades into skeleton positions over 150ms. No layout shift.","error":"Skeleton transforms to error state: 'We couldn't load this — Try again'."},"transitions":"Skeleton → Data: 150ms fade-in. Content appears like ink on a pre-printed form.","micro_interactions":"Shimmer animation at 1.5s cycle. Pulse animation for slow loads at 1s cycle."},
    "copy_spec": {"headline":"","body":"","cta":"","tone":"No copy in skeleton state. The skeleton's shape IS the communication."},
    "html_css": "<div class=\"skeleton-proposal\"><div class=\"skel-area\"><div class=\"skel-line skel-heading\"></div><div class=\"skel-line skel-body\"></div><div class=\"skel-line skel-body short\"></div></div><div class=\"skel-area tinted\"><div class=\"skel-line skel-amount\"></div><div class=\"skel-line skel-body\"></div></div><div class=\"skel-area\"><div class=\"skel-line skel-button\"></div></div></div><style>.skeleton-proposal{max-width:480px;border:1px solid #e5e7eb;border-radius:12px;overflow:hidden;font-family:'Inter',sans-serif}.skel-area{padding:24px}.skel-area+.skel-area{border-top:1px solid #e5e7eb}.skel-area.tinted{background:rgb(252,250,255)}.skel-line{background:#f3f4f6;border-radius:6px;animation:shimmer 1.5s ease-in-out infinite;background-size:200% 100%;background-image:linear-gradient(90deg,#f3f4f6 25%,#e5e7eb 50%,#f3f4f6 75%)}.skel-heading{height:24px;width:60%;margin-bottom:12px}.skel-body{height:14px;width:90%;margin-bottom:8px}.skel-body.short{width:50%}.skel-amount{height:28px;width:40%;margin-bottom:8px}.skel-button{height:48px;width:100%;border-radius:20px}@keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}</style>",
    "before_after": {"before":"Full-page loading spinner on blank white screen. Drew sees nothing for 1-2 seconds. Then the entire page renders at once — jarring content flash.","after":"Billboard structure renders in 200ms: three-area layout with skeleton placeholders matching final content dimensions. Drew's eye can identify areas before data arrives."},
    "rationale": "Krug Ch. 2: users scan pages 'like a billboard at 60 mph.' Drew's scan starts the instant the page appears. The skeleton renders the billboard structure immediately."
  },
  {
    "id": "ui-015",
    "name": "Convention-Matching Photo Upload Zone",
    "category": "works",
    "phase": "listing_creation",
    "priority": "medium",
    "visual_spec": {"colors":{"zone_border":"#e5e7eb","zone_border_hover":"rgb(109, 49, 194)","link_color":"rgb(109, 49, 194)"},"typography":{"prompt":"16px / 600 / Inter","hint":"13px / 400 / Inter"}},
    "interaction_spec": {"states":{"default":"Dashed border, centered icon and text. Large click/tap target.","hover":"Border color shifts to purple. Background gains subtle tint.","dragging":"Border becomes solid purple, 2px. 'Drop to upload' text replaces default."},"transitions":"Drag enter/exit: 150ms border transition. Thumbnail appearance: 200ms fade-in with spring easing.","micro_interactions":"On successful upload, thumbnail appears with subtle scale-up. Zone text updates: '3 photos uploaded — add more?'"},
    "copy_spec": {"headline":"Drop photos here or browse","body":"You mentioned having more pictures ready — JPG or PNG, up to 10MB each","cta":"browse","tone":"Encouraging, references the call."},
    "html_css": "<div class=\"upload-zone-demo\"><div class=\"upload-icon\">&#x1F4F7;</div><div class=\"upload-prompt\">Drop photos here or <a href=\"#\" class=\"upload-browse\">browse</a></div><div class=\"upload-hint\">You mentioned having more pictures ready</div></div><style>.upload-zone-demo{max-width:480px;border:2px dashed #e5e7eb;border-radius:12px;padding:48px 24px;text-align:center;cursor:pointer;transition:all 0.15s ease;font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif}.upload-zone-demo:hover{border-color:rgb(109,49,194);background:rgb(252,250,255)}.upload-icon{font-size:36px;margin-bottom:12px;filter:grayscale(1);opacity:0.5}.upload-prompt{font-size:16px;font-weight:600;color:#374151;margin-bottom:8px}.upload-browse{color:rgb(109,49,194);text-decoration:none;font-weight:600}.upload-browse:hover{text-decoration:underline}.upload-hint{font-size:13px;color:#9ca3af}</style>",
    "before_after": {"before":"Custom upload interface with a small 'Select Files' button, 'Add from URL' option, and 'Request from photographer' link. Three competing interaction models.","after":"Universal drag-and-drop zone matching what Drew has seen on every file-sharing site. Dashed border = drop zone. 'Browse' link = file picker. No surprises."},
    "rationale": "Krug Ch. 3: 'conventions are your friends.' Drew offered to send photos during the call. The upload step should capitalize on this with the most conventional upload pattern available."
  }
];

// ===== STATE =====
let activeFilters = { category: null, phase: null, priority: null };
let searchTerm = '';
let compareMode = false;
let compareSelected = new Set();

// ===== HELPERS =====
function formatPhase(p) {
  const map = {
    onboarding: 'Onboarding',
    proposal_mgmt: 'Proposals',
    pricing: 'Pricing',
    listing_creation: 'Listing Creation',
    active_lease: 'Active Lease',
    retention: 'Retention'
  };
  return map[p] || p;
}

function escapeHtml(str) {
  const d = document.createElement('div');
  d.textContent = str;
  return d.innerHTML;
}

function createIframeSrcdoc(htmlCss) {
  return '<!DOCTYPE html><html><head><meta charset="UTF-8"><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=IBM+Plex+Mono:wght@400;500;600;700&display=swap" rel="stylesheet"><style>*{margin:0;padding:0;box-sizing:border-box}body{padding:20px;font-family:Inter,-apple-system,sans-serif;background:#fff}</style></head><body>' + htmlCss + '</body></html>';
}

// ===== FILTERING =====
function getFilteredElements() {
  return elements.filter(el => {
    if (activeFilters.category && el.category !== activeFilters.category) return false;
    if (activeFilters.phase && el.phase !== activeFilters.phase) return false;
    if (activeFilters.priority && el.priority !== activeFilters.priority) return false;
    if (searchTerm) {
      const s = searchTerm.toLowerCase();
      const haystack = (el.name + ' ' + el.category + ' ' + el.phase + ' ' + el.priority + ' ' + (el.copy_spec.headline || '') + ' ' + (el.copy_spec.tone || '') + ' ' + el.id).toLowerCase();
      if (!haystack.includes(s)) return false;
    }
    return true;
  });
}

// ===== RENDERING =====
function renderGrid() {
  const filtered = getFilteredElements();
  const grid = document.getElementById('cardGrid');
  const empty = document.getElementById('emptyState');
  const count = document.getElementById('resultsCount');

  count.textContent = filtered.length + ' element' + (filtered.length !== 1 ? 's' : '');

  if (filtered.length === 0) {
    grid.style.display = 'none';
    empty.style.display = 'block';
    return;
  }
  grid.style.display = 'grid';
  empty.style.display = 'none';

  grid.innerHTML = filtered.map(el => {
    const isSelected = compareSelected.has(el.id);
    return `
      <div class="element-card ${isSelected ? 'compare-selected' : ''}" data-id="${el.id}" onclick="handleCardClick('${el.id}', event)">
        <div class="card-compare-check ${isSelected ? 'checked' : ''}" onclick="event.stopPropagation(); toggleCompareSelect('${el.id}')">
          ${isSelected ? '✓' : ''}
        </div>
        <div class="card-preview">
          <iframe srcdoc="${escapeHtml(createIframeSrcdoc(el.html_css))}" sandbox="allow-same-origin" loading="lazy" tabindex="-1"></iframe>
        </div>
        <div class="card-body">
          <div class="card-meta">
            <span class="badge badge-${el.category}">${el.category}</span>
            <span class="badge badge-phase">${formatPhase(el.phase)}</span>
            <span class="badge badge-priority-${el.priority}">${el.priority}</span>
          </div>
          <div class="card-title">${escapeHtml(el.name)}</div>
          <div class="card-rationale">${escapeHtml(el.rationale)}</div>
        </div>
      </div>
    `;
  }).join('');
}

function handleCardClick(id, event) {
  if (compareMode) {
    toggleCompareSelect(id);
  } else {
    openModal(id);
  }
}

// ===== CHIPS =====
document.querySelectorAll('.chip[data-filter]').forEach(chip => {
  chip.addEventListener('click', () => {
    const filterType = chip.dataset.filter;
    const value = chip.dataset.value;

    if (activeFilters[filterType] === value) {
      activeFilters[filterType] = null;
      chip.classList.remove('active');
    } else {
      document.querySelectorAll(`.chip[data-filter="${filterType}"]`).forEach(c => c.classList.remove('active'));
      activeFilters[filterType] = value;
      chip.classList.add('active');
    }
    renderGrid();
  });
});

// ===== SEARCH =====
document.getElementById('searchInput').addEventListener('input', function() {
  searchTerm = this.value.trim();
  renderGrid();
});

// ===== COMPARE MODE =====
function toggleCompareMode() {
  compareMode = !compareMode;
  const btn = document.getElementById('compareToggle');
  const gridEl = document.getElementById('gridContainer');
  btn.classList.toggle('active', compareMode);
  gridEl.classList.toggle('compare-mode', compareMode);

  if (!compareMode) {
    compareSelected.clear();
    updateCompareBar();
  }
  renderGrid();
}

function toggleCompareSelect(id) {
  if (!compareMode) return;
  if (compareSelected.has(id)) {
    compareSelected.delete(id);
  } else {
    compareSelected.add(id);
  }
  renderGrid();
  updateCompareBar();
}

function updateCompareBar() {
  const bar = document.getElementById('compareBar');
  const countEl = document.getElementById('compareCount');
  if (compareMode && compareSelected.size > 0) {
    bar.classList.add('visible');
    countEl.textContent = compareSelected.size;
  } else {
    bar.classList.remove('visible');
  }
}

function clearCompare() {
  compareSelected.clear();
  updateCompareBar();
  renderGrid();
}

function showCompareView() {
  if (compareSelected.size < 2) return;
  const gridContainer = document.getElementById('gridContainer');
  const toolbar = document.getElementById('toolbar');
  const compareView = document.getElementById('compareView');
  const compareGrid = document.getElementById('compareGrid');
  const compareBar = document.getElementById('compareBar');

  gridContainer.style.display = 'none';
  toolbar.style.display = 'none';
  compareBar.classList.remove('visible');
  compareView.classList.add('visible');

  const count = compareSelected.size;
  compareGrid.className = 'compare-grid ' + (count === 2 ? 'compare-grid-2' : count === 3 ? 'compare-grid-3' : 'compare-grid-4plus');

  const selectedEls = elements.filter(el => compareSelected.has(el.id));
  compareGrid.innerHTML = selectedEls.map(el => `
    <div class="compare-card">
      <div class="compare-card-preview">
        <iframe srcdoc="${escapeHtml(createIframeSrcdoc(el.html_css))}" sandbox="allow-same-origin" loading="lazy"></iframe>
      </div>
      <div class="compare-card-body">
        <div class="card-meta" style="margin-bottom:8px">
          <span class="badge badge-${el.category}">${el.category}</span>
          <span class="badge badge-priority-${el.priority}">${el.priority}</span>
        </div>
        <div class="compare-card-title">${escapeHtml(el.name)}</div>
        <div class="compare-card-desc">${formatPhase(el.phase)} · ${escapeHtml(el.copy_spec.headline || el.copy_spec.cta || '')}</div>
      </div>
    </div>
  `).join('');
}

function exitCompareView() {
  document.getElementById('gridContainer').style.display = 'block';
  document.getElementById('toolbar').style.display = 'flex';
  document.getElementById('compareView').classList.remove('visible');
  updateCompareBar();
}

// ===== MODAL =====
function openModal(id) {
  const el = elements.find(e => e.id === id);
  if (!el) return;

  const overlay = document.getElementById('modalOverlay');
  const preview = document.getElementById('modalPreview');
  const content = document.getElementById('modalContent');

  // Preview
  preview.innerHTML = `
    <button class="modal-close" onclick="closeModal()">&#x2715;</button>
    <iframe srcdoc="${escapeHtml(createIframeSrcdoc(el.html_css))}" sandbox="allow-same-origin" style="width:100%;height:100%;border:none"></iframe>
  `;

  // Specs
  const vs = el.visual_spec;
  const is = el.interaction_spec;
  const cs = el.copy_spec;

  let colorSwatches = '';
  if (vs.colors) {
    const colors = Object.entries(vs.colors).slice(0, 6);
    colorSwatches = colors.map(([k, v]) => `
      <div class="spec-item">
        <div class="spec-item-label">${k.replace(/_/g, ' ')}</div>
        <div class="spec-item-value" style="display:flex;align-items:center;gap:8px">
          <span style="display:inline-block;width:16px;height:16px;border-radius:4px;background:${v};border:1px solid #e5e7eb;flex-shrink:0"></span>
          <code>${v}</code>
        </div>
      </div>
    `).join('');
  }

  let statesHtml = '';
  if (is.states) {
    statesHtml = Object.entries(is.states).map(([k, v]) => `
      <div class="spec-item">
        <div class="spec-item-label">${k}</div>
        <div class="spec-item-value">${escapeHtml(v)}</div>
      </div>
    `).join('');
  }

  content.innerHTML = `
    <div class="modal-header">
      <div class="modal-title">${escapeHtml(el.name)}</div>
      <div class="modal-badges">
        <span class="badge badge-${el.category}">${el.category}</span>
        <span class="badge badge-phase">${formatPhase(el.phase)}</span>
        <span class="badge badge-priority-${el.priority}">${el.priority}</span>
      </div>
    </div>

    ${cs.headline || cs.body || cs.cta ? `
    <div class="modal-section">
      <div class="modal-section-title">Copy Spec</div>
      <div class="copy-spec-grid">
        ${cs.headline ? `<div class="copy-item"><span class="copy-item-label">Headline</span><span class="copy-item-value">${escapeHtml(cs.headline)}</span></div>` : ''}
        ${cs.body ? `<div class="copy-item"><span class="copy-item-label">Body</span><span class="copy-item-value">${escapeHtml(cs.body)}</span></div>` : ''}
        ${cs.cta ? `<div class="copy-item"><span class="copy-item-label">CTA</span><span class="copy-item-value">${escapeHtml(cs.cta)}</span></div>` : ''}
        ${cs.tone ? `<div class="copy-item"><span class="copy-item-label">Tone</span><span class="copy-item-value" style="color:#6b7280">${escapeHtml(cs.tone)}</span></div>` : ''}
      </div>
    </div>
    ` : ''}

    ${colorSwatches ? `
    <div class="modal-section">
      <div class="modal-section-title">Visual Spec</div>
      <div class="spec-grid">${colorSwatches}</div>
    </div>
    ` : ''}

    ${statesHtml ? `
    <div class="modal-section">
      <div class="modal-section-title">Interaction States</div>
      <div class="spec-grid">${statesHtml}</div>
    </div>
    ` : ''}

    ${is.transitions || is.micro_interactions ? `
    <div class="modal-section">
      <div class="modal-section-title">Transitions & Micro-interactions</div>
      <div class="spec-grid">
        ${is.transitions ? `<div class="spec-item"><div class="spec-item-label">Transitions</div><div class="spec-item-value">${escapeHtml(is.transitions)}</div></div>` : ''}
        ${is.micro_interactions ? `<div class="spec-item"><div class="spec-item-label">Micro-interactions</div><div class="spec-item-value">${escapeHtml(is.micro_interactions)}</div></div>` : ''}
      </div>
    </div>
    ` : ''}

    <div class="modal-section">
      <div class="modal-section-title">Rationale</div>
      <div class="modal-rationale">${escapeHtml(el.rationale)}</div>
    </div>

    ${el.before_after ? `
    <div class="modal-section">
      <div class="modal-section-title">Before & After</div>
      <div class="before-after">
        <div class="ba-card ba-before">
          <div class="ba-label">Before</div>
          ${escapeHtml(el.before_after.before)}
        </div>
        <div class="ba-card ba-after">
          <div class="ba-label">After</div>
          ${escapeHtml(el.before_after.after)}
        </div>
      </div>
    </div>
    ` : ''}
  `;

  overlay.classList.add('visible');
  document.body.style.overflow = 'hidden';
}

function closeModal(event) {
  if (event && event.target !== event.currentTarget) return;
  document.getElementById('modalOverlay').classList.remove('visible');
  document.body.style.overflow = '';
}

document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    closeModal();
  }
});

// ===== INIT =====
renderGrid();
</script>
</body>
</html>